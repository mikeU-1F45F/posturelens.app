<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PostureLens</title>
  <link rel="stylesheet" href="/style.css">
  <script src="/holistic.js" crossorigin="anonymous"></script>
</head>
<body>
  <div id="app">
    <header class="app-header">
      <h1>PostureLens</h1>
      <div id="status">Loading...</div>
    </header>

    <div id="progress-container" class="progress-container" style="display: none;" role="group" aria-label="Loading progress">
      <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
        <div id="progress-fill" class="progress-fill"></div>
      </div>
      <div id="progress-text" class="progress-text" aria-live="polite"></div>
    </div>

    <div class="main-layout">
      <div id="video-container" class="video-container">
        <div class="video-wrapper">
          <video id="video-preview" autoplay playsinline aria-label="Webcam preview"></video>
          <canvas id="detection-canvas" aria-hidden="true"></canvas>
        </div>
        <div id="detection-status" class="detection-status" aria-label="Detection status">
          <span class="status-label">Pose: <span id="pose-status">-</span></span>
          <span class="status-label">L Hand: <span id="left-hand-status">-</span></span>
          <span class="status-label">R Hand: <span id="right-hand-status">-</span></span>
          <span class="status-label">Face: <span id="face-status">-</span></span>
        </div>
      </div>

      <aside class="controls-panel">
        <div id="reference-status" class="reference-status" aria-live="polite"></div>
        <div class="button-group" role="group" aria-label="Monitoring controls">
          <button id="capture-btn" disabled aria-label="Capture reference pose">Capture Reference Pose</button>
          <button id="start-btn" disabled aria-label="Start monitoring">Start Monitoring</button>
        </div>

        <div class="model-toggle" role="group" aria-label="Model selection">
          <label class="model-toggle__label" for="full-model-toggle">
            <input id="full-model-toggle" type="checkbox" disabled />
            Use full pose model
          </label>
          <div id="full-model-status" class="model-toggle__status" aria-live="polite">
            Full model: checkingâ€¦
          </div>
        </div>

        <div class="sensitivity" role="group" aria-label="Sensitivity">
          <label class="sensitivity__label" for="face-touch-sensitivity">
            Face-touch sensitivity
          </label>
          <select id="face-touch-sensitivity" class="sensitivity__select" aria-label="Face-touch sensitivity">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
          </select>

          <label class="sensitivity__label" for="posture-sensitivity">
            Posture sensitivity
          </label>
          <select id="posture-sensitivity" class="sensitivity__select" aria-label="Posture sensitivity">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
          </select>
        </div>

        <p class="privacy-notice" role="note">
          ðŸ”’ No photos taken, retained, or transmitted.
          All data stays local to this browser.
        </p>
        <a id="clear-data-link" href="#" class="clear-data-link">Clear all local data</a>
      </aside>
    </div>

    <div id="toast" class="toast" role="alert" aria-live="assertive"></div>

    <div
      id="update-toast"
      class="update-toast"
      role="alertdialog"
      aria-live="polite"
      aria-label="Update available"
      style="display: none;"
    >
      <div id="update-toast-text" class="update-toast__text">
        New version available. Reload?
      </div>
      <div class="update-toast__actions">
        <button id="update-toast-yes" type="button" class="update-toast__btn">Yes</button>
        <button id="update-toast-no" type="button" class="update-toast__btn update-toast__btn--secondary">No</button>
      </div>
    </div>
  </div>
  
  <canvas id="ghost-canvas" aria-hidden="true"></canvas>
  
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker
        .register('/sw.js', { updateViaCache: 'none' })
        .then((reg) => {
          console.info('[PostureLens] Service worker registered:', reg.scope)
        })
        .catch((error) => {
          console.warn('[PostureLens] Service worker registration failed:', error)
        })
    }
  </script>
  <script src="/main.js"></script>
</body>
</html>
